<form [formGroup]="form" class="quick-order-form-container">
  <div class="quick-order-form-input">
    <input
      (blur)="onBlur($event.relatedTarget)"
      (keydown.arrowdown)="focusNextChild()"
      (keydown.arrowup)="focusPreviousChild()"
      (keydown.enter)="addProduct($event)"
      (keydown.escape)="clear($event)"
      [attr.aria-label]="'common.search' | cxTranslate"
      class="form-control"
      formControlName="product"
      placeholder="{{ 'quickOrderForm.placeholder' | cxTranslate }}"
      type="text"
    />

    <cx-icon
      (click)="clear($event)"
      [type]="isResultsBoxOpen() ? iconTypes.RESET : iconTypes.SEARCH"
      [ngClass]="{
        'quick-order-form-reset-icon': isResultsBoxOpen(),
        'quick-order-form-search-icon': !isResultsBoxOpen()
      }"
      class="search"
      tabindex="-1"
    ></cx-icon>

    <span
      *ngIf="!(canAddProduct() | async) && form.get('product')?.dirty"
      class="list-limit-reached-text"
    >
      {{ 'quickOrderForm.listLimitReached' | cxTranslate }}
    </span>
  </div>

  <div *ngIf="isResultsBoxOpen()" role="listbox" class="quick-order-results">
    <ul
      *ngIf="results.length; else noResults"
      class="quick-order-results-products"
      tabindex="0"
    >
      <li
        *ngFor="let product of results; let i = index"
        (click)="add(product, $event)"
        (keydown.enter)="add(product, $event)"
        (keydown.escape)="clear($event)"
        [class.has-media]="config?.quickOrder?.searchForm?.displayProductImages"
        [ngClass]="{ active: getFocusedElementIndex() === i }"
        class="quick-order-results-product"
      >
        <cx-media
          *ngIf="config?.quickOrder?.searchForm?.displayProductImages"
          [container]="product.images?.PRIMARY"
          class="media"
          format="thumbnail"
          role="presentation"
        ></cx-media>
        <div class="name" [innerHTML]="product.name"></div>
        <span class="id">
          {{
            'quickOrderForm.id'
              | cxTranslate
                : {
                    id: product.code
                  }
          }}
        </span>
        <span class="price">{{ product.price?.formattedValue }}</span>
      </li>
    </ul>

    <ng-template #noResults>
      <span class="quick-order-no-results">
        {{ 'quickOrderForm.noResults' | cxTranslate }}
      </span>
    </ng-template>
  </div>
</form>
